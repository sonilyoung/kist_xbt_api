<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="egovframework.com.adm.eduMgr.dao.EduMgrDAO">
	
	<!-- 교육관리-->
		
	<!-- 교육과정관리-그룹관리 조회-->
	<select id="selectBaselineList" parameterType="egovframework.com.adm.eduMgr.vo.Baseline" resultType="egovframework.com.adm.eduMgr.vo.Baseline" >			
         
		SELECT PROC_CD
			,PROC_YEAR
			,PROC_SEQ 
			,PROC_NAME
			,concat(EDU_START_DATE , ' ~ ' , EDU_END_DATE) AS EDU_DATE
			,EDU_START_DATE
			,EDU_END_DATE
			,TOT_STUDY_DATE /*학습일*/
			,STUDY_LVL
			,TIMESTAMPDIFF(DAY, EDU_START_DATE , EDU_END_DATE) AS TOT_TIME_DIFF /*전체학습일*/
			,TIMESTAMPDIFF(DAY, EDU_START_DATE , CURDATE()) AS TIME_DIFF /*진행학습일*/			
			,LIMIT_PERSON_CNT
			,ENDING_STD_SCORE /*수료기준점수*/
			,ENDING_PROCESS_END_YN /*수료완료유무*/
			,PRACTICE_TOTAL_SCORE /*실기가중치*/
			,EVALUATION_TOTAL_SCORE	/*평가가중치*/		
			,THEORY_TOTAL_SCORE /*이론평가가중치*/		
			,INSERT_DATE
			,INSERT_ID
			,UPDATE_DATE
			,UPDATE_ID
		FROM XBT_BASELINE			
         
        <!--
		<choose>
			<when test='searchType == "1"'>
	            AND TA1.PARENT_PROC_GROUP_CD = '*'                                                  /* 상위과정분류코드 */
	            AND TA1.TOP_PROC_GROUP_CD    = '*'                                                  /* 최상위과정분류코드 */			
			</when>
			<when test='searchType == "2"'>
				AND TA1.PARENT_PROC_GROUP_CD = #{procGroupCd}/* 상위과정분류코드 */
			</when>
			<when test='searchType == "1"'>
				AND TA1.PARENT_PROC_GROUP_CD = #{procGroupCd}                                                  /* 상위과정분류코드 */	
			</when>			
		</choose>	
		  --> 	         
	</select>  
	
	
	<!-- 차수 상세 -->
	<select id="selectBaseline" parameterType="egovframework.com.adm.eduMgr.vo.Baseline" resultType="egovframework.com.adm.eduMgr.vo.Baseline">
		SELECT PROC_CD
			,PROC_YEAR
			,PROC_SEQ 
			,PROC_NAME
			,concat(EDU_START_DATE , ' ~ ' , EDU_END_DATE) AS EDU_DATE
			,EDU_START_DATE
			,EDU_END_DATE
			,TOT_STUDY_DATE /*학습일*/
			,STUDY_LVL
			,TIMESTAMPDIFF(DAY, EDU_START_DATE , EDU_END_DATE) AS TOT_TIME_DIFF /*전체학습일*/
			,TIMESTAMPDIFF(DAY, EDU_START_DATE , CURDATE()) AS TIME_DIFF /*진행학습일*/			
			,LIMIT_PERSON_CNT
			,ENDING_STD_SCORE /*수료기준점수*/
			,ENDING_PROCESS_END_YN /*수료완료유무*/
			,PRACTICE_TOTAL_SCORE /*실기가중치*/
			,EVALUATION_TOTAL_SCORE	/*평가가중치*/		
			,THEORY_TOTAL_SCORE /*이론평가가중치*/		
			,INSERT_DATE
			,INSERT_ID
			,UPDATE_DATE
			,UPDATE_ID
		FROM XBT_BASELINE	
		WHERE PROC_CD = #{procCd}
	</select>		
	
	<!-- 차수 등록 -->
	<insert id="insertBaseline" parameterType="egovframework.com.adm.eduMgr.vo.Baseline" useGeneratedKeys="true" keyProperty="procCd">
		INSERT INTO XBT_BASELINE(
			PROC_YEAR,
			PROC_SEQ,
			PROC_NAME,
			EDU_START_DATE,
			EDU_END_DATE,
			TOT_STUDY_DATE,
			STUDY_LVL,
			LIMIT_PERSON_CNT,
			ENDING_STD_SCORE,
			ENDING_PROCESS_END_YN,
			PRACTICE_TOTAL_SCORE,
			EVALUATION_TOTAL_SCORE,
			THEORY_TOTAL_SCORE,
			INSERT_DATE,
			INSERT_ID
		)VALUES(
			 DATE_FORMAT(NOW(),'%Y')
			,#{procSeq}
			,#{procName}
			,#{eduStartDate}
			,#{eduEndDate}
			,#{totStudyDate}
			,#{studyLvl}
			,#{limitPersonCnt}
			,#{endingStdScore}
			,'N'
			,#{practiceTotalScore}
			,#{evaluationTotalScore}
			,#{theoryTotalScore}
			,now()
			,#{insertId}
		)
	</insert>	
	
	
	<!-- 차수 수정 -->
	<update id="updateBaseline" parameterType="egovframework.com.adm.eduMgr.vo.Baseline">	
		UPDATE XBT_BASELINE
		SET 
			PROC_SEQ = #{procSeq},
			PROC_NAME = #{procName},
			EDU_START_DATE = #{eduStartDate},
			EDU_END_DATE = #{eduEndDate},
			TOT_STUDY_DATE = #{totStudyDate},
			LIMIT_PERSON_CNT = #{limitPersonCnt},
			ENDING_STD_SCORE = #{endingStdScore},
			ENDING_PROCESS_END_YN = #{endingProcessEndYn},
			PRACTICE_TOTAL_SCORE = #{practiceTotalScore},
			EVALUATION_TOTAL_SCORE = #{evaluationTotalScore},
			THEORY_TOTAL_SCORE = #{theoryTotalScore},
			STUDY_LVL = #{studyLvl},
			UPDATE_DATE = #{insertId},
			UPDATE_ID = now()
		WHERE PROC_CD = #{procCd}
	</update>	
	
	<!-- 차수 삭제-->
	<delete id="deleteBaseline" parameterType="egovframework.com.adm.eduMgr.vo.Baseline">
		DELETE FROM XBT_BASELINE WHERE PROC_CD = #{procCd}
	</delete>	
	
	<!-- 교육생목로조회 -->
	<select id="selectBaselineStudentList" parameterType="egovframework.com.adm.eduMgr.vo.Student" resultType="egovframework.com.adm.eduMgr.vo.Student">
		SELECT 
			STUDENT_NO,
			PROC_CD,
			PROC_YEAR,
			PROC_SEQ,
			USER_ID,
			USER_NM,
			PROC_NM,
			COMP_NM,
			DEPT_NM,
			GAIN_SCORE,
			PASS_YN,
			ENDING_PROCESS_DATE,
			ENDING_YN,
			INSERT_DATE,
			INSERT_ID,
			UPDATE_DATE,
			UPDATE_ID
		FROM XBT_BASELINE_STUDENT_INFO
		WHERE PROC_CD = #{procCd}
	</select>	
	
	<!-- 교육생상세조회 -->
	<select id="selectBaselineStudent" parameterType="egovframework.com.adm.eduMgr.vo.Student" resultType="egovframework.com.adm.eduMgr.vo.Student">
		SELECT 
			STUDENT_NO,
			PROC_CD,
			PROC_YEAR,
			PROC_SEQ,
			USER_ID,
			PROC_NM,
			COMP_NM,
			DEPT_NM,
			GAIN_SCORE,
			PASS_YN,
			ENDING_PROCESS_DATE,
			ENDING_YN,
			INSERT_DATE,
			INSERT_ID,
			UPDATE_DATE,
			UPDATE_ID
		FROM XBT_BASELINE_STUDENT_INFO
		WHERE USER_ID = #{userId}
		AND PROC_CD = #{procCd}
	</select>	
		
			
	<!-- 교육생 등록 -->
	<insert id="insertBaselineStudent" parameterType="egovframework.com.adm.eduMgr.vo.Student">
		INSERT INTO XBT_BASELINE_STUDENT_INFO(
			PROC_CD,
			PROC_YEAR,
			PROC_SEQ,
			USER_ID,
			USER_NM,
			PROC_NM,
			COMP_NM,
			DEPT_NM,
			GAIN_SCORE,
			PASS_YN,
			ENDING_PROCESS_DATE,
			ENDING_YN,
			EDU_START_DATE,
			EDU_END_DATE,
			INSERT_DATE,
			INSERT_ID
		)VALUES(
			#{procCd}
			,#{procYear}
			,#{procSeq}
			,#{userId}
			,#{userNm}
			,#{procNm}
			,#{compNm}
			,#{deptNm}
			,0
			,'N'
			,#{endingProcessDate}
			,'N'
			,#{eduStartDate}
			,#{eduEndDate}
			,now()
			,#{insertId}
		)
	
	</insert>	
	
	
	<!-- 교육생 삭제-->
	<delete id="deleteBaselineStudent" parameterType="egovframework.com.adm.eduMgr.vo.Student">
		DELETE FROM XBT_BASELINE_STUDENT_INFO WHERE USER_ID = #{userId}
	</delete>	
	
	<!-- 교육생 모두삭제-->
	<delete id="deleteBaselineStudentAll" parameterType="egovframework.com.adm.eduMgr.vo.Student">
		DELETE FROM XBT_BASELINE_STUDENT_INFO WHERE PROC_CD = #{procCd}
	</delete>		
	
	
	<!-- 교육일정 목록 -->
	<select id="selectEduDateList" parameterType="egovframework.com.adm.eduMgr.vo.EduDate" resultType="egovframework.com.adm.eduMgr.vo.EduDate">
	<![CDATA[
		SELECT DISTINCT
			PROC_CD,
			PROC_NM,
			MODULE_ID,
			EDU_DATE,
			MENU_CD,
			MENU_NM,
			MENU_TYPE,
			MODULE_TYPE,
			INSERT_ID,
			INSERT_DATE,
			CASE WHEN EDU_DATE < date_format(NOW(), '%Y-%m-%d') THEN "true" else "false" end learnYn
		FROM XBT_BASELINE_EDU_DATE
		WHERE PROC_CD = #{procCd}
	]]>
		<choose>
			<when test='command == "menuList"'>
				AND (MODULE_TYPE IS NOT NULL OR MODULE_TYPE != '')
			</when>
			<when test='command == "moduleList"'>
				AND (MODULE_TYPE IS NULL OR MODULE_TYPE = '')
			</when>
		</choose>		
	</select>		

	
	<!-- 교육일정 등록 -->
	<insert id="insertEduDate" parameterType="egovframework.com.adm.eduMgr.vo.EduDate">
		INSERT INTO XBT_BASELINE_EDU_DATE(
			PROC_CD,
			PROC_NM,
			MODULE_ID,
			USER_ID,
			EDU_DATE,
			MENU_CD,
			MENU_NM,
			MODULE_TYPE,
			MENU_TYPE,
			INSERT_ID,
			INSERT_DATE
		)VALUES(
			#{procCd}
			,#{procNm}
			,#{moduleId}
			,#{userId}
			,#{eduDate}
			,#{menuCd}
			,#{menuNm}
			,#{moduleType}
			,#{menuType}
			,#{insertId}
			,now()
		)
	
	</insert>	
	
	
	<!-- 교육일정 삭제-->
	<delete id="deleteEduDate" parameterType="egovframework.com.adm.eduMgr.vo.EduDate">
		DELETE FROM XBT_BASELINE_EDU_DATE WHERE DAY_NO = #{dayNo}
	</delete>	
	
	<!-- 교육일정 모두삭제-->
	<delete id="deleteEduDateAll" parameterType="egovframework.com.adm.eduMgr.vo.EduDate">
		DELETE FROM XBT_BASELINE_EDU_DATE WHERE PROC_CD = #{procCd}
	</delete>	
		
	
			
	
</mapper>